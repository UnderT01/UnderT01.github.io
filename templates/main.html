<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link text="text/css" href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <title>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>
</head>
<body>
<div class="header">
    <div class="logo">
        <a href="/">COOKING</a>
        <div class="banner">
            <a href="/">KOTYA <span>&</span> SHPROT</a>
        </div>
    </div>
</div>
<div class="search-block">
    <img src="{{ url_for('static', filename='pictures/bread.png') }}" class="img-search">
    <form action="{{ url_for('search') }}" method="get" class="search-line">
        <input type="search" name="q" placeholder="–ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–∞...">
        <button type="submit">
            <img src="{{ url_for('static', filename='lupa.png') }}" alt="–ü–æ–∏—Å–∫" width="20" height="20">
        </button>
    </form>
</div>


<div class="categorys">
    <div class="category-hot">
        <img src="{{ url_for('static', filename='pictures/–≥–æ—Ä—è—á–µ–µ.jpg') }}" class="hot">
        <p class="hot-link"><a href="/hot-recipes">–ì–æ—Ä—è—á–µ–µ</a></p>
    </div>
    <div class="category-cold">
        <p class="cold-link"><a href="/cold-recipes">–•–æ–ª–æ–¥–Ω–æ–µ</a></p>
        <img src="{{ url_for('static', filename='pictures/IceZalypa.jpg') }}" class="cold">
    </div>
    <div class="category-salad">
        <img src="{{ url_for('static', filename='pictures/—Å–∞–ª–∞—Ç.jpg') }}" class="salad">
        <p class="salad-link"><a href="/salad-recipes">–°–∞–ª–∞—Ç—ã</a></p>
    </div>
    <div class="category-snacks">
        <p class="snacks-link"><a href="/snacks-recipes">–ó–∞–∫—É—Å–∫–∏</a></p>
        <img src="{{ url_for('static', filename='pictures/–∑–∞–∫—É—Å–∫–∏.jpg') }}" class="snacks">
    </div>
    <div class="category-soups">
        <img src="{{ url_for('static', filename='pictures/—Å—É–ø—ã.jpg') }}" class="soups">
        <p class="soups-link"><a href="/soups-recipes">–°—É–ø—ã</a></p>
    </div>
    <div class="category-delivery">
        <p class="delivery-link"><a href="/delivery-recipes">–î–æ—Å—Ç–∞–≤–∫–∞</a></p>
        <img src="{{ url_for('static', filename='pictures/–ö—É—Ä–∞.jpg') }}" class="delivery">
    </div>
    <div class="category-all">
        <img src="{{ url_for('static', filename='pictures/all_eat.jpg') }}" class="all">
        <p class="all-link"><a href="/all_recipes">–í—Å–µ</a></p>
    </div>
</div>
<div class="create-your-recipe">
    <a href="/create" class="btn-create">–°–æ–∑–¥–∞—Ç—å —Å–≤–æ–π —Ä–µ—Ü–µ–ø—Ç +</a>
</div>
<div class="roulette">
    <p class="banner-roulette">Rouletteating</p>
</div>
<div class="choise-roulette">
    <p class="random">
        ALL RANDOM <br>
        <button id="openModalBtn" class="start-all">START</button>
    </p>

    <p class="random-category">
        RANDOM IN CATEGORY <br>
        <select id="categorySelect">
            <option value="–≥–æ—Ä—è—á–µ–µ">–ì–æ—Ä—è—á–µ–µ</option>
            <option value="—Ö–æ–ª–æ–¥–Ω–æ–µ">–•–æ–ª–æ–¥–Ω–æ–µ</option>
            <option value="—Å–∞–ª–∞—Ç">–°–∞–ª–∞—Ç—ã</option>
            <option value="–∑–∞–∫—É—Å–∫–∞">–ó–∞–∫—É—Å–∫–∏</option>
            <option value="—Å—É–ø—ã">–°—É–ø—ã</option>
            <option value="–¥–æ—Å—Ç–∞–≤–∫–∞">–î–æ—Å—Ç–∞–≤–∫–∞</option>
        </select>
        <button id="openCategoryBtn" class="start-category">START</button>
    </p>
</div>

<div id="myModal" class="modal">
    <div class="modal-all-random">
        <span class="close-modal">&times;</span>
        <img id="recipe-image" src="" alt="">
        <h2><a id="recipe-title" href="#">–†–µ—Ü–µ–ø—Ç</a></h2>
        <p id="recipe-description"></p>
        <p class="categor"><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> <span id="recipe-category"></span></p>
        <p id="modal-error" style="color: #b00; display:none;"></p>
    </div>
</div>
<div class="end-container">
    <svg viewBox="0 0 300 300" width="300" height="300" class="text-circle">
        <defs>
            <path id="circlePath" d="M 150, 150 m -120, 0 a 120,120 0 1,1 240,0 a 120,120 0 1,1 -240,0"/>
        </defs>
        <text font-size="48" fill="black" font-family="Arial, sans-serif">
            <textPath href="#circlePath" startOffset="50%" text-anchor="middle">
                –°–¥–µ–ª–∞–Ω–æ –º–Ω–æ–π –¥–ª—è –ª—é–±–∏–º–æ–π üíõ
            </textPath>
        </text>
    </svg>
</div>

<script>
    // —ç–ª–µ–º–µ–Ω—Ç—ã
    const modal = document.getElementById("myModal");
    const openModalBtn = document.getElementById("openModalBtn");
    const openCategoryBtn = document.getElementById("openCategoryBtn");
    const closeBtn = document.querySelector(".close-modal");
    const categorySelect = document.getElementById("categorySelect");

    const titleEl = document.getElementById("recipe-title");
    const imgEl = document.getElementById("recipe-image");
    const descEl = document.getElementById("recipe-description");
    const catEl = document.getElementById("recipe-category");
    const errEl = document.getElementById("modal-error");

    function showModal() {
      errEl.style.display = "none";
      modal.style.display = "flex";
    }
    function hideModal() {
      modal.style.display = "none";
    }
    function showError(msg) {
      errEl.innerText = msg;
      errEl.style.display = "block";
      titleEl.innerText = "–û—à–∏–±–∫–∞";
      descEl.innerText = "";
      catEl.innerText = "";
      imgEl.src = "";
      showModal();
    }

    async function loadRandom(url) {
      try {
        const resp = await fetch(url, {cache: "no-cache"});
        if (!resp.ok) {
          const text = await resp.text();
          console.error("Server returned non-OK:", resp.status, text.slice(0,200));
          showError("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: " + resp.status);
          return;
        }
        // –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –æ—Ç–≤–µ—Ç JSON
        const contentType = resp.headers.get("Content-Type") || "";
        if (!contentType.includes("application/json")) {
          const txt = await resp.text();
          console.error("–ù–µ JSON –æ—Ç–≤–µ—Ç:", txt.slice(0,200));
          showError("–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç");
          return;
        }

        const data = await resp.json();
        if (data.error) {
          showError(data.error);
          return;
        }

        // –£—Å–ø–µ—Ö ‚Äî –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        titleEl.innerText = data.title || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
        titleEl.href = `/recipe_detail/${data.id}`;
        descEl.innerText = data.description || "";
        catEl.innerText = data.category || "";
        imgEl.src = data.image || "";
        imgEl.alt = data.title || "–§–æ—Ç–æ —Ä–µ—Ü–µ–ø—Ç–∞";
        showModal();
      } catch (err) {
        console.error("Fetch error:", err);
        showError("–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: " + (err.message || err));
      }
    }

    openModalBtn.addEventListener("click", () => loadRandom("/random_recipe"));

    openCategoryBtn.addEventListener("click", () => {
      const cat = categorySelect.value;
      // –∏—Å–ø–æ–ª—å–∑—É–µ–º query param, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
      const url = "/random_recipe_by_category?category=" + encodeURIComponent(cat);
      loadRandom(url);
    });

    closeBtn.addEventListener("click", hideModal);
    window.addEventListener("click", (e) => { if (e.target === modal) hideModal(); });
</script>

</body>
</html>